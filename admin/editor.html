<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Editar Cart√£o</title>
<style>
  body{ font-family:Arial; padding:20px; background:#f3f3f3; }
  textarea{
    width:100%; height:450px;
    border-radius:10px; padding:12px;
    font-size:14px;
  }
  button{
    padding:12px 20px; margin-top:10px;
    background:black; color:white;
    border:none; border-radius:10px;
    cursor:pointer;
  }
</style>
</head>
<body>
<script>
  if(localStorage.getItem('auth') !== 'ok') location.href = 'login.html';
</script>

<h2 id="titulo"></h2>
<textarea id="editor"></textarea>
<br>
<button onclick="salvar()">Salvar</button>

<script>
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  document.getElementById('titulo').innerText = 'Editando: ' + id;

  async function carregar(){
    try{
      const dados = await fetch('../data/' + id + '.json').then(r=>r.json());
      document.getElementById('editor').value = JSON.stringify(dados, null, 2);
    }catch{
      document.getElementById('editor').value = '{\n"backgroundImage":"",\n"backgroundOpacity":0.5,\n"logo":"",\n"botoes":[],\n"servicos":[]\n}';
    }
  }
  carregar();

  async function salvar(){
    const texto = document.getElementById('editor').value;
    const resposta = await fetch('/api/salvar',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ id, conteudo:texto })
    });
    if(resposta.ok) alert('Salvo com sucesso!');
    else alert('Erro ao salvar');
  }
</script>

</body>
</html>

